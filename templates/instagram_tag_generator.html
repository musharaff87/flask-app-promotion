{% extends "base.html" %}
{% block title %}Instagram Tag Generator - AI Hashtag Tool{% endblock %}
{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold">üì∑ Instagram Tag Generator</h1>
        <p class="lead">Generate trending hashtags for your Instagram posts using AI</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-body p-4">
                    <form id="tagGeneratorForm">
                        <div class="mb-3">
                            <label for="contentPrompt" class="form-label">Describe your content:</label>
                            <textarea
                                class="form-control"
                                id="contentPrompt"
                                rows="4"
                                placeholder="E.g., Beautiful sunset photo at the beach with friends, vacation vibes, summer evening..."
                                required
                            ></textarea>
                            <div class="form-text">Describe what your post is about, the mood, location, or theme</div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="tagStyle" class="form-label">Hashtag Style:</label>
                                <select class="form-select" id="tagStyle">
                                    <option value="trending">Trending (Popular tags for maximum reach)</option>
                                    <option value="niche">Niche (Specific tags for engaged audience)</option>
                                    <option value="mixed">Mixed (Balanced approach)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="tagCount" class="form-label">Number of tags:</label>
                                <select class="form-select" id="tagCount">
                                    <option value="15">15 tags</option>
                                    <option value="20">20 tags</option>
                                    <option value="30" selected>30 tags (Recommended)</option>
                                    <option value="40">40 tags</option>
                                    <option value="50">50 tags</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <span class="spinner-border spinner-border-sm d-none" id="loadingSpinner"></span>
                                Generate Hashtags ‚ú®
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="mt-4 d-none">
                <div class="card shadow">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Generated Hashtags</h5>
                        <button class="btn btn-sm btn-outline-primary" id="copyAllBtn">
                            Copy All
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="hashtagResults" class="hashtag-container"></div>
                        <div class="mt-3">
                            <small class="text-muted">
                                üí° Tip: Use a mix of popular and niche hashtags for best results. Instagram allows up to 30 hashtags per post.
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Section -->
            <div id="errorSection" class="mt-4 d-none">
                <div class="alert alert-danger">
                    <strong>Error:</strong> <span id="errorMessage"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-5">
        <a href="/social-media" class="btn btn-outline-primary">‚Üê Back to Social Media Tools</a>
    </div>
</div>

<style>
.hashtag-container {
    max-height: 400px;
    overflow-y: auto;
}

.hashtag-tag {
    display: inline-block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.25rem 0.75rem;
    margin: 0.25rem;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

.hashtag-tag:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.hashtag-tag.copied {
    background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    animation: pulse 0.5s;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('tagGeneratorForm');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const resultsSection = document.getElementById('resultsSection');
    const errorSection = document.getElementById('errorSection');
    const hashtagResults = document.getElementById('hashtagResults');
    const copyAllBtn = document.getElementById('copyAllBtn');

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        const prompt = document.getElementById('contentPrompt').value.trim();
        const style = document.getElementById('tagStyle').value;
        const count = parseInt(document.getElementById('tagCount').value);

        if (!prompt) {
            showError('Please describe your content');
            return;
        }

        // Show loading state
        setLoadingState(true);
        hideResults();
        hideError();

        try {
            const response = await fetch('/api/generate_instagram_tags', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: prompt,
                    style: style,
                    count: count
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to generate tags');
            }

            if (data.success && data.tags) {
                displayResults(data.tags);
            } else {
                throw new Error('Invalid response format');
            }

        } catch (error) {
            console.error('Error:', error);
            showError(error.message);
        } finally {
            setLoadingState(false);
        }
    });

    copyAllBtn.addEventListener('click', function() {
        const tags = Array.from(document.querySelectorAll('.hashtag-tag'))
            .map(tag => '#' + tag.textContent.trim())
            .join(' ');

        copyToClipboard(tags);

        // Show feedback
        this.textContent = 'Copied!';
        setTimeout(() => {
            this.textContent = 'Copy All';
        }, 2000);
    });

    function setLoadingState(loading) {
        const submitBtn = form.querySelector('button[type="submit"]');
        if (loading) {
            loadingSpinner.classList.remove('d-none');
            submitBtn.disabled = true;
            submitBtn.textContent = ' Generating...';
        } else {
            loadingSpinner.classList.add('d-none');
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'Generate Hashtags ‚ú®';
        }
    }

    function displayResults(tags) {
        hashtagResults.innerHTML = '';

        tags.forEach(tag => {
            const tagElement = document.createElement('span');
            tagElement.className = 'hashtag-tag';
            tagElement.textContent = tag;
            tagElement.addEventListener('click', function() {
                copyToClipboard('#' + tag);
                this.classList.add('copied');
                setTimeout(() => {
                    this.classList.remove('copied');
                }, 1000);
            });
            hashtagResults.appendChild(tagElement);
        });

        resultsSection.classList.remove('d-none');
    }

    function showError(message) {
        document.getElementById('errorMessage').textContent = message;
        errorSection.classList.remove('d-none');
    }

    function hideError() {
        errorSection.classList.add('d-none');
    }

    function hideResults() {
        resultsSection.classList.add('d-none');
    }

    function copyToClipboard(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text);
        } else {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }
    }
});
</script>
{% endblock %}